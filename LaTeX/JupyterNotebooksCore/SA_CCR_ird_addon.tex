    

    
    \hypertarget{addon-for-interest-rate-derivatives}{%
\subsection{AddOn for interest rate
derivatives}\label{addon-for-interest-rate-derivatives}}

\hypertarget{step-1---calculation-of-effective-notional-d_jkir}{%
\paragraph{\texorpdfstring{Step 1 - calculation of effective notional
\(D_{jk}^{IR}\)}{Step 1 - calculation of effective notional D\_\{jk\}\^{}\{IR\}}}\label{step-1---calculation-of-effective-notional-d_jkir}}

\begin{align*}
D_{jk}^{IR} &= \sum_{i\in\left\{Ccy_j, MB_k\right\}}{\delta_i*d_i^{IR}*MF_i}
\end{align*}

Here, the notation \(i\in\left\{Ccy_j, MB_k\right\}\) refers to trades
whose underlying is the interest rate of a common currency \(j\) and
which mature in a common maturity bucket \(k\)

    We can test our implementation of the effective notional against a small
exemplary portfolio in Annex 4a Example 1 of the SA\_CCR paper. It
consists of the following trades:

\begin{longtable}[]{@{}llllllll@{}}
\toprule
\begin{minipage}[b]{0.04\columnwidth}\raggedright
Trade \#\strut
\end{minipage} & \begin{minipage}[b]{0.10\columnwidth}\raggedright
Nature\strut
\end{minipage} & \begin{minipage}[b]{0.09\columnwidth}\raggedright
Residual Maturity\strut
\end{minipage} & \begin{minipage}[b]{0.07\columnwidth}\raggedright
Base Ccy\strut
\end{minipage} & \begin{minipage}[b]{0.11\columnwidth}\raggedright
Notional (tsd)\strut
\end{minipage} & \begin{minipage}[b]{0.11\columnwidth}\raggedright
Pay Leg\strut
\end{minipage} & \begin{minipage}[b]{0.13\columnwidth}\raggedright
Receive Leg\strut
\end{minipage} & \begin{minipage}[b]{0.13\columnwidth}\raggedright
Market value (tsd)\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.04\columnwidth}\raggedright
1\strut
\end{minipage} & \begin{minipage}[t]{0.10\columnwidth}\raggedright
Interest rate swap\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright
10 years\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\raggedright
USD\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright
10000\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright
Fixed\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\raggedright
Floating\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\raggedright
30\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.04\columnwidth}\raggedright
2\strut
\end{minipage} & \begin{minipage}[t]{0.10\columnwidth}\raggedright
Interest rate swap\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright
4 years\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\raggedright
USD\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright
10000\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright
Floating\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\raggedright
Fixed\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\raggedright
-20\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.04\columnwidth}\raggedright
3\strut
\end{minipage} & \begin{minipage}[t]{0.10\columnwidth}\raggedright
European Swaption\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright
1 into 10 years\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\raggedright
EUR\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright
5000\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright
Floating\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\raggedright
Fixed\strut
\end{minipage} & \begin{minipage}[t]{0.13\columnwidth}\raggedright
50\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

To set up this exemplary portfolio we need to find fixed rates for the
swaps and underlying swaps to match the desired market values.

    Through optimization and using the market data of the 10th of May 2019
the fixed rates to match the market values in Example 1 were identified.

    For trade 1 the matching fixed rate is 2.3754\%, for trade 1 it is
2.2108\% and for the underlying swap of trade 3 it is 0.1610\%

    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{In}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{ca}\PY{o}{=}\PY{n}{CollateralAgreement}\PY{p}{(}\PY{p}{)}

\PY{n+nb}{print}\PY{p}{(}\PY{n}{SA\PYZus{}CCR}\PY{o}{.}\PY{n}{calculate\PYZus{}sa\PYZus{}ccr\PYZus{}delta}\PY{p}{(}\PY{n}{trade\PYZus{}1}\PY{p}{)}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{n}{SA\PYZus{}CCR}\PY{o}{.}\PY{n}{trade\PYZus{}level\PYZus{}adjusted\PYZus{}notional}\PY{p}{(}\PY{n}{trade\PYZus{}1}\PY{p}{)}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{n}{SA\PYZus{}CCR}\PY{o}{.}\PY{n}{calculate\PYZus{}sa\PYZus{}ccr\PYZus{}delta}\PY{p}{(}\PY{n}{trade\PYZus{}2}\PY{p}{)}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{n}{SA\PYZus{}CCR}\PY{o}{.}\PY{n}{trade\PYZus{}level\PYZus{}adjusted\PYZus{}notional}\PY{p}{(}\PY{n}{trade\PYZus{}2}\PY{p}{)}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{n}{SA\PYZus{}CCR}\PY{o}{.}\PY{n}{calculate\PYZus{}sa\PYZus{}ccr\PYZus{}delta}\PY{p}{(}\PY{n}{trade\PYZus{}3}\PY{p}{)}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{n}{SA\PYZus{}CCR}\PY{o}{.}\PY{n}{trade\PYZus{}level\PYZus{}adjusted\PYZus{}notional}\PY{p}{(}\PY{n}{trade\PYZus{}3}\PY{p}{)}\PY{p}{)}

\PY{n}{SA\PYZus{}CCR}\PY{o}{.}\PY{n}{interest\PYZus{}rate\PYZus{}addOn}\PY{p}{(}\PY{n}{test\PYZus{}portfolio}\PY{p}{,}\PY{n}{ca}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
1
78638320.21725275
-1
36198301.54418307
-0.00343382383244269
31712286.360503413
    \end{Verbatim}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{Out}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
89019.81894092409
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{In}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{export}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{SA\PYZus{}CCR\PYZus{}ird\PYZus{}addon.ipynb}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}


